package assignment03;

import java.io.File;
import java.io.IOException;
import java.util.Scanner;

import javax.swing.JFileChooser;
import javax.swing.JOptionPane;

public class SummaryFileVerifier {

	public static void main(String[] args) {
		JFileChooser chooser = new JFileChooser("/Users/Henry/Documents/workspace/CS1410/src/assignment03");
		chooser.setDialogTitle("Which file would you like to verify?");
		
		int result;
		result = chooser.showOpenDialog(null);
		
		if (result == JFileChooser.CANCEL_OPTION) {
			return;
		}
		
		File inputFile;
		inputFile = chooser.getSelectedFile();
		
		System.out.println("You chose: " + inputFile);
		try {
			Scanner in = new Scanner(inputFile);
			
			scanNextTransaction(in);
			
			System.out.println("File verified ok.");
			
			in.close();
		
		} catch (IOException e) {
			System.out.println("Could not read the file: " + inputFile);
		}
		
	}
	
	public static boolean isSummary (String s) {
		if (s.length() >= 2 && s.startsWith("SUM") && s.charAt(0) != '$')
			return true;
		else 
			return false;
	}
	
	public static boolean isBuy (String s) {
		if (s.length() >= 3 && s.startsWith("BUY") && s.charAt(0) != '$')
			return true;
		else 
			return false;
	}
	
	public static boolean isSell (String s) {
		if (s.length() >= 2 && s.startsWith("SELL") && s.charAt(0) != '$')
			return true;
		else 
			return false;
	}
	

	public static double moneyValue (String openName) {
		String finalValue = openName.replace("$", "");
		
		return Double.parseDouble(finalValue);
	}

	public static double scanNextTransaction(Scanner s) {
		double sumOfSummary = 0;
		double sumOfSubSummary = 0;
		double totalValue = 0;
		int summaryEntry = 0;
		
		String line = s.next();
		System.out.println(line);

		if (isSummary(line)) {
			String date = s.next(); // date
			String summaryValue = s.next(); // money value
			sumOfSummary = moneyValue(summaryValue); // setting the summary total to a double value
				
			summaryEntry = s.nextInt(); // gets the number of entries
				
			totalValue = sumOfSummary + scanSubSummary(s, summaryEntry); 

		}
		
		if (isBuy(line) || isSell(line)) {
			String date = s.next();	// date
			String value = s.next(); // value
	
			sumOfSummary += moneyValue(value);
		}
			
		if (Math.round(100 * sumOfSummary) != Math.round(100 * sumOfSubSummary)) {				
			JOptionPane.showMessageDialog(null, "error in the file and summary does not match" );
			System.exit(0);
			}
			
		return totalValue;
		
	}
	
	public static double scanSubSummary(Scanner s, int numberOfEntry) {
		double sumOfSummarySum = 0;
		
		for (int i = 0; i < numberOfEntry; i++) {
			sumOfSummarySum = scanNextTransaction(s);
		}
		
		return sumOfSummarySum;
	}

}
